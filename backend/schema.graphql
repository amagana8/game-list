type User @exclude(operations: [CREATE, DELETE]) {
  id: ID! @id @auth(rules: [{ allow: { id: "$jwt.sub" } }])
  username: String! @unique @readonly
  email: String! @unique @readonly @auth(rules: [{ allow: { id: "$jwt.sub" } }])
  password: String! @private
  gameList: [Game!]!
    @relationship(type: "LISTED", properties: "ListEntry", direction: OUT)
}

type Game @exclude(operations: [DELETE]) {
  id: ID! @id
  title: String
  developers: [String!]!
  publishers: [String!]!
  genre: Genre
  summary: String
  userList: [User!]!
    @relationship(type: "LISTED", properties: "ListEntry", direction: IN)
}

interface ListEntry @relationshipProperties {
  status: Status
  hours: Int
  score: Int
}

enum Status {
  playing
  completed
  paused
  dropped
  planning
}

enum Genre {
  adventure
  board
  fighting
  horror
  racing
  rpg
  rhythm
  sandbox
  shooter
  simulation
  sports
  strategy
}

type Mutation {
  signUp(username: String!, email: String!, password: String!): String!
  signIn(email: String!, password: String!): String!
  updateUserDetails(
    username: String!
    newUsername: String
    newEmail: String
  ): String!
}

type Query {
  searchUsers(query: String): [User!]!
    @cypher(
      statement: "MATCH (n:User) WHERE toLower(n.username) CONTAINS toLower($query) RETURN n"
    )
  searchGames(query: String): [Game!]!
    @cypher(
      statement: "MATCH (n:Game) WHERE toLower(n.title) CONTAINS toLower($query) RETURN n"
    )
}

extend type Game
  @auth(rules: [{ operations: [CREATE, UPDATE], isAuthenticated: true }])

extend type User
  @auth(
    rules: [
      { operations: [UPDATE, CONNECT, DISCONNECT], allow: { id: "$jwt.sub" } }
    ]
  )
